<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì°½í˜ ë‹¨íƒ€ ì‹œë®¬ë ˆì´í„° A-Ver</title>

<style>
    body {
        background: #1e1e1e;
        color: #dedede;
        font-family: 'Noto Sans KR', sans-serif;
        padding: 15px;
    }
    h1 {
        text-align: center;
        color: #ffffff;
        margin-bottom: 10px;
    }
    .section {
        background: #2b2b2b;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    input, button {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        margin-bottom: 8px;
        border-radius: 8px;
        border: none;
        font-size: 1rem;
    }
    input {
        background: #3b3b3b;
        color: white;
    }
    button {
        background: #4a4a4a;
        color: white;
        font-weight: bold;
    }
    button:hover {
        background: #616161;
    }
    .result-box {
        background: #333;
        padding: 15px;
        border-radius: 10px;
        margin-top: 15px;
    }
    .tag {
        background: #444;
        padding: 4px 8px;
        border-radius: 4px;
        margin-right: 6px;
        font-size: 0.8rem;
        display: inline-block;
        margin-bottom: 4px;
    }
    hr {
        border: 0;
        border-top: 1px solid #555;
        margin: 15px 0;
    }
</style>

</head>
<body>

<h1>ğŸ“ˆ ì°½í˜ ë‹¨íƒ€ ì‹œë®¬ë ˆì´í„° A-Ver</h1>

<div class="section">
    <h2>1) ì¢…ëª© ì…ë ¥</h2>
    <input id="ticker" placeholder="ì˜ˆ: 005930 (ì‚¼ì„±ì „ì)" />
    <button onclick="fetchData()">ë°ì´í„° ë¡œë”©í•˜ê¸°</button>
</div>

<div class="section">
    <h2>2) ìë™ ë¶„ì„ ê²°ê³¼</h2>
    <div id="analysis" class="result-box">ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
</div>

<script>
// =============== API KEY ì…ë ¥ ===============
const API_KEY = "RU288LYDRA1FH4H4";   // â† Chadì˜ Alpha Vantage í‚¤

// =============== ë©”ì¸ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜ ===============
async function fetchData() {
    const ticker = document.getElementById("ticker").value.trim();
    if (!ticker) {
        alert("ì¢…ëª© ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
    }

    const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${ticker}.KS&apikey=${API_KEY}`;

    document.getElementById("analysis").innerHTML = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...â³";

    try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data["Time Series (Daily)"]) {
            document.getElementById("analysis").innerHTML = "ë°ì´í„° ì˜¤ë¥˜ ë˜ëŠ” ì¡°íšŒ ì œí•œ ë°œìƒ!";
            return;
        }

        evaluateStock(data["Time Series (Daily)"]);
    } catch (e) {
        document.getElementById("analysis").innerHTML = "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” CORS ì°¨ë‹¨!";
    }
}

// =============== í•µì‹¬ ë¡œì§: ë‹¨íƒ€ ê³µì‹ A ê¸°ì¤€ ë¶„ì„ ===============
function evaluateStock(timeData) {
    const dates = Object.keys(timeData).slice(0, 25); 
    const prices = dates.map(d => parseFloat(timeData[d]["4. close"]));
    const volumes = dates.map(d => parseFloat(timeData[d]["5. volume"]));

    const ma5 = avg(prices.slice(0, 5));
    const ma20 = avg(prices.slice(0, 20));

    const today = prices[0];
    const yesterdayVol = volumes[1];

    let score = 0;
    let reasons = [];

    if (today > ma20) {
        score += 1;
        reasons.push("20ì¼ì„  ìœ„ (ì•ˆì „)");
    } else {
        reasons.push("20ì¼ì„  ì•„ë˜ â†’ ìœ„í—˜");
    }

    if (ma5 > ma20) {
        score += 1;
        reasons.push("5ì¼ì„ ì´ 20ì¼ì„  ìƒí–¥ ëŒíŒŒ");
    }

    if (volumes[0] > yesterdayVol * 1.5) {
        score += 1;
        reasons.push("ê±°ë˜ëŸ‰ ì¦ê°€ (ìˆ˜ê¸‰ ìœ ì…)");
    }

    const rsi = calcRSI(prices.reverse());
    if (rsi >= 45 && rsi <= 60) {
        score += 1;
        reasons.push("RSI ê±´ê°• êµ¬ê°„");
    }

    let signal = "";
    if (score >= 3) signal = "ğŸŸ¢ ë§¤ìˆ˜ ìœ ë ¥";
    else if (score == 2) signal = "ğŸŸ¡ ê´€ë§";
    else signal = "ğŸ”´ ë§¤ìˆ˜ì£¼ì˜";

    const resultHTML = `
        <h3>ğŸ“Œ ë¶„ì„ ê²°ê³¼: ${signal}</h3>
        <p>í˜„ì¬ ê°€ê²©: <b>${today.toLocaleString()}</b></p>
        <p>RSI: <b>${rsi.toFixed(1)}</b></p>
        <h4>ì¡°ê±´ ì¶©ì¡± ë‚´ì—­:</h4>
        ${reasons.map(r => `<div class='tag'>${r}</div>`).join("")}
        <hr/>
        <h4>ğŸŸ¢ ë§¤ìˆ˜ ì¡°ê±´(ì ìˆ˜ 3 ì´ìƒ)</h4>
        âœ” 20ì¼ì„  ìœ„<br>
        âœ” 5ì¼ì„  > 20ì¼ì„ <br>
        âœ” ê±°ë˜ëŸ‰ +50% ì´ìƒ<br>
        âœ” RSI 45~60
        <hr/>
        <h4>ğŸ”» ë§¤ë„ ì¡°ê±´</h4>
        âœ” 5ì¼ì„  ì´íƒˆ<br>
        âœ” RSI > 70<br>
        âœ” ê±°ë˜ëŸ‰ ê¸‰ê°<br>
        âœ” ì†ì ˆ -3% / ìµì ˆ +5~7%
    `;

    document.getElementById("analysis").innerHTML = resultHTML;
}

// =============== ìœ í‹¸ í•¨ìˆ˜ ===============
function avg(arr) {
    return arr.reduce((a, b) => a + b, 0) / arr.length;
}

function calcRSI(values) {
    let gains = 0, losses = 0;
    for (let i = 1; i < values.length; i++) {
        let diff = values[i] - values[i - 1];
        if (diff > 0) gains += diff;
        else losses -= diff;
    }
    let rs = gains / (losses || 1);
    return 100 - (100 / (1 + rs));
}

</script>
</body>
</html>
